var eventAux=null;function asistencia(){var e="mes="+$("#calendarioWeb .fc-toolbar .fc-center h2").html();$.ajax({url:"http://comedor.undac.edu.pe:8094/reserva/asistenciasFaltas",type:"POST",data:e,success:function(e){var r=JSON.parse(e);$("#falta").html(r[0].falta),$("#asistencia").html(r[0].asistencia)}}).done(function(){console.log("success")}).fail(function(e,r,t){0===e.status?alertify.error("No Conectado: Verifique su conexión a Internet."):404==e.status?alertify.error("Error [404]: Página no encontrada."):500==e.status?alertify.error("Error [500]: Error Servidor Interno."):"timeout"===r&&alertify.error("Error de tiempo de espera... :(")}).always(function(){console.log("complete")}),$.ajax({url:"http://comedor.undac.edu.pe:8094/reserva/asistencia",type:"POST",success:function(e){for(var r=JSON.parse(e),t=0,a="",o=0;o<r.length;o++){for(var n=0;n<r.length-1&&(r[o].skd_date==r[n].skd_date&&1==r[n].assist&&(t+=1),2!=t);n++);0==t?a="#f8d7da":1==t?a="#fff3cd":2==t&&(a="#d4edda"),$(".fc-day").each(function(){$(this).attr("data-date")==r[o].skd_date&&$(this).css("background-color",a)}),t=0}}}).done(function(){console.log("success")}).fail(function(e,r,t){0===e.status?alertify.error("No Conectado: Verifique su conexión a Internet."):404==e.status?alertify.error("Error [404]: Página no encontrada."):500==e.status?alertify.error("Error [500]: Error Servidor Interno."):"timeout"===r&&alertify.error("Error de tiempo de espera... :(")}).always(function(){console.log("complete")})}function checkMenuEnable(e,r){var t="idMenu="+r;$.ajax({url:"http://comedor.undac.edu.pe:8094/menu/checkMenuEnable",type:"POST",data:t,success:function(t){var a=JSON.parse(t);if($("#listHorary").html(""),0==a.state){var o='<div class="col-lg-12"><div class="alert alert-danger" role="alert"><p>'+a.message+"</p></div></div>";$("#listHorary").append(o)}else 1==a.state&&showHorary(e,r)}}).done(function(){console.log("success")}).fail(function(e,r,t){0===e.status?alertify.error("No Conectado: Verifique su conexión a Internet."):404==e.status?alertify.error("Error [404]: Página no encontrada."):500==e.status?alertify.error("Error [500]: Error Servidor Interno."):"timeout"===r&&alertify.error("Error de tiempo de espera... :(")}).always(function(){console.log("complete")})}function showHorary(e,r){var t="typeMenu="+e+"&idMenu="+r;$.ajax({url:"http://comedor.undac.edu.pe:8094/horario/getHoraryCantReser",type:"POST",data:t,beforeSend:function(){document.getElementById("mostrar_loadingHR").style.display="block"},success:function(e){console.log(e),document.getElementById("mostrar_loadingHR").style.display="none";var t=JSON.parse(e),a=t.data;if($("#listHorary").html(""),0==t.state){var o='<div class="col-lg-6"><div class="alert alert-danger" role="alert">'+t.message+"</div></div>";$("#listHorary").append(o)}else if(1==t.state){for(var n=0;n<a.length;n++){o='<div class="col-lg-6"> <div class="row caja justify-content-center align-items-center"><div class="col-5 horas text-center"><img src="http://comedor.undac.edu.pe:8094/img/hora.png" width="40" height="40"> <h4 class="h4-r">Horarios</h4><h5 class="h5-r">'+a[n].food_start_char+" a "+a[n].food_end_char+'</h5></div><div class="col-4 horas text-center cantidadReserva"><img src="http://comedor.undac.edu.pe:8094/img/grupo.png" width="60" height="40"><h4 class="h4-r">Reservado</h4><h5 class="h5-r"><b class="contador'+n+'">'+a[n].cantreser+"</b> de ("+a[n].cant+')</h5></div><div class="col-3 horas text-center"><div class="checkbox"><label style="font-size: 2.5em; background: #2ecc71; border-radius: 50px; color: white;"><input type="checkbox" class="only-one" value="'+a[n].id+'" id="checketReservation" name="checketReservation" onclick="reservation(this); "><span class="cr" style="margin-right: 0px;" ><i class="cr-icon fa fa-check"></i></span></label></div></div></div></div>';$("#listHorary").append(o)}captureReservationUser(r)}}}).done(function(){console.log("success")}).fail(function(e,r,t){0===e.status?alertify.error("No Conectado: Verifique su conexión a Internet."):404==e.status?alertify.error("Error [404]: Página no encontrada."):500==e.status?alertify.error("Error [500]: Error Servidor Interno."):"timeout"===r&&alertify.error("Error de tiempo de espera... :(")}).always(function(){console.log("complete")})}function reservation(e){var r=e.value,t=document.getElementsByName("checketReservation");e.checked?confirmReservation("¿Desea Confirmar su Reservación?")?(addReservation(r),t.forEach(r=>{r!==e&&(r.checked=!1)})):(e.checked=!1,alertify.error("Reserva no Realizada")):confirmReservation("¿Desea Cancelar su Reservación?")?(addReservation(-1),t.forEach(r=>{r!==e&&(r.checked=!1)})):(alertify.error("Reserva no Cancelada"),e.checked=!0)}function confirmReservation(e){return!!confirm(e)}function addReservation(e){var r="idMenu="+$("#menuTitle").attr("data-idM")+"&idHorary="+e;$.ajax({url:"http://comedor.undac.edu.pe:8094/create/reservation/",type:"POST",data:r,success:function(e){var r=JSON.parse(e);console.log(e),0==r.state?alertify.error(r.message):1==r.state&&(alertify.success(r.message),showHorary(eventAux.type,eventAux.id))}}).done(function(){console.log("success")}).fail(function(e,r,t){0===e.status?alertify.error("No Conectado: Verifique su conexión a Internet."):404==e.status?alertify.error("Error [404]: Página no encontrada."):500==e.status?alertify.error("Error [500]: Error Servidor Interno."):"timeout"===r&&alertify.error("Error de tiempo de espera... :(")}).always(function(){console.log("complete")})}function captureReservationUser(e){var r="idMenu="+e;$.ajax({url:"http://comedor.undac.edu.pe:8094/capture/reservation/",type:"POST",data:r,success:function(e){var r=JSON.parse(e);0!=r.length&&recorrerCheckbox(r[0].id_timetable)}}).done(function(){console.log("success")}).fail(function(e,r,t){0===e.status?alertify.error("No Conectado: Verifique su conexión a Internet."):404==e.status?alertify.error("Error [404]: Página no encontrada."):500==e.status?alertify.error("Error [500]: Error Servidor Interno."):"timeout"===r&&alertify.error("Error de tiempo de espera... :(")}).always(function(){console.log("complete")})}function dateFormat(e){return null==e?null:moment(e).format("DD/MM/YYYY").split("/").reverse().join("-")}function timeFormat(e){return null==e?null:moment(e).format("HH:mm:ss")}function recorrerCheckbox(e){$(".only-one").each(function(){$(this).val()==e&&$(this).attr("checked","true")})}$(document).ready(function(){$(".cerrar").click(function(){$.ajax({url:"http://comedor.undac.edu.pe:8094/close/login/user/",method:"POST",success:function(e){setTimeout(function(){location.reload()},700)}})}),$.ajax({url:"http://comedor.undac.edu.pe:8094/menu/dato/todo/",beforeSend:function(e){document.getElementById("mostrar_loadingR").style.display="block",document.getElementById("calendarioWeb").style.display="none"},success:function(e){document.getElementById("mostrar_loadingR").style.display="none",document.getElementById("calendarioWeb").style.display="block";for(var r=JSON.parse(e),t=new Array,a=0;a<r.length;a++){var o="",n="",s="";1==r[a].type?(o="Desayuno",n="#FF5733",s="#FF5733"):2==r[a].type?(o="Almuerzo",n="#4F248B",s="#4F248B"):3==r[a].type&&(o="Cena",n="#8B5024",s="#8B5024");var i={};i.id=r[a].id,i.type=r[a].type,i.title=o,i.second=r[a].second,i.soup=r[a].soup,i.drink=r[a].drink,i.fruit=r[a].fruit,i.dessert=r[a].dessert,i.aditional=r[a].aditional,i.start=r[a].skd_date,i.backgroundColor=n,i.borderColor=s,i.textColor="#FFF",t.push(i)}$("#calendarioWeb").fullCalendar({header:{left:"today, prev, next",center:"title",right:"month, basicWeek, basicDay"},droppable:!0,hiddenDays:[6,0],events:t,eventClick:function(e,r,t){var a=$("#calendarioWeb").fullCalendar("getDate");dateActual=dateFormat(a.format()),dateFormat(e.start)<dateActual?alertify.error("Lo sentimos. No puede realizar una Reserva en una Fecha Pasada."):(eventAux=e,1===e.type?$("#desayuno").html("Desayuno"):$("#desayuno").html("Infusión"),$("#menuTitle").html("Reservación "+e.title),$("#menuTitle").attr("data-idM",e.id),$("#dateMenu").html("Menu del Día "+dateFormat(e.start)),$("#detailSecond").html(e.second),$("#detailSoup").html(e.soup),$("#detailDrink").html(e.drink),$("#detailFruit").html(e.fruit),$("#detailDessert").html(e.dessert),$("#detailAditional").html(e.aditional),$("#modalReserva").modal(),checkMenuEnable(e.type,e.id))},eventAfterAllRender:function(){asistencia()}})}}).done(function(){console.log("success")}).fail(function(e,r,t){0===e.status?alertify.error("No Conectado: Verifique su conexión a Internet."):404==e.status?alertify.error("Error [404]: Página no encontrada."):500==e.status?alertify.error("Error [500]: Error Servidor Interno."):"timeout"===r&&alertify.error("Error de tiempo de espera... :(")}).always(function(){console.log("complete")})});